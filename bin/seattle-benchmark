#!/usr/bin/env ruby

## Copyright (c) Cognitect, Inc.
## All rights reserved.

$LOAD_PATH << File.expand_path("../../lib", __FILE__)
require 'benchmark'
require 'stringio'
require 'json'
require 'transit'
require 'yajl'

def read_transit(data)
  io = StringIO.new(data, 'r')
  Transit::Reader.new(:json).read(io)
end

def read_json(data)
  io = StringIO.new(data, 'r')
  Yajl::Parser.parse(io)
end

data = nil
open("../transit/seattle-data0.tjs", 'r') do |f|
  data = f.read
end

n = 50

include Benchmark

Benchmark.benchmark(CAPTION, 15, FORMAT, "transit  (avg):", "yalj     (avg):") do |bm|
  t = bm.report("transit (#{n} x):") { n.times { read_transit(data) } }
  y = bm.report("yajl    (#{n} x):") { n.times { read_json(data) } }
  [t/n, y/n]
end
